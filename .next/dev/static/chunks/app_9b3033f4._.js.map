{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/lib/firebase.ts"],"sourcesContent":["import { initializeApp, getApps, getApp } from \"firebase/app\";\nimport { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, where, orderBy, Timestamp } from \"firebase/firestore\";\nimport { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, User, browserLocalPersistence, setPersistence} from \"firebase/auth\";\n\nconst firebaseConfig = {\n  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,\n  authDomain: `${process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID}.firebaseapp.com`,\n  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\n  storageBucket: `${process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID}.appspot.com`,\n  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,\n};\n\nconst app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApp();\n\nexport const db = getFirestore(app);\nexport const auth = getAuth(app);\n\nif (typeof window !== 'undefined') {\n  setPersistence(auth, browserLocalPersistence).catch(console.error);\n}\n\nexport interface Bill {\n  id?: string;\n  userId: string;\n  providerName: string;\n  billType: string;\n  amount: number;\n  dueDate: Date;\n  createdAt: Date;\n}\n\nexport async function registerUser(email: string, password: string) {\n  const result = await createUserWithEmailAndPassword(auth, email, password);\n  return result.user;\n}\n\nexport async function loginUser(email: string, password: string) {\n  const result = await signInWithEmailAndPassword(auth, email, password);\n  return result.user;\n}\n\nexport async function logoutUser() {\n  await signOut(auth);\n}\n\nexport function subscribeToAuth(callback: (user: User | null) => void) {\n  return onAuthStateChanged(auth, callback);\n}\n\nexport async function addBill(userId: string, bill: Omit<Bill, 'id' | 'userId' | 'createdAt'>) {\n  // Ensure we have a current user before attempting Firestore write\n  const currentUser = auth.currentUser;\n  if (!currentUser) {\n    throw new Error('User must be authenticated to add bills');\n  }\n  \n  // Force refresh the ID token to ensure Firestore has valid credentials\n  await currentUser.getIdToken(true);\n  \n  console.log('Adding bill for userId:', userId, 'currentUser:', currentUser.uid);\n  \n  const docRef = await addDoc(collection(db, \"bills\"), {\n    ...bill,\n    userId,\n    dueDate: Timestamp.fromDate(new Date(bill.dueDate)),\n    createdAt: Timestamp.now(),\n  });\n  console.log('Bill added successfully with id:', docRef.id);\n  return docRef.id;\n}\n\nexport async function fetchBills(userId: string): Promise<Bill[]> {\n  try {\n    // Ensure we have a current user before attempting Firestore read\n    const currentUser = auth.currentUser;\n    if (!currentUser) {\n      console.log('No authenticated user, returning empty bills');\n      return [];\n    }\n    \n    // Force refresh the ID token to ensure Firestore has valid credentials\n    await currentUser.getIdToken(true);\n    \n    console.log('fetchBills called for userId:', userId);\n    console.log('Current auth uid:', currentUser.uid);\n    console.log('Firebase projectId:', firebaseConfig.projectId);\n    \n    const q = query(\n      collection(db, \"bills\"),\n      where(\"userId\", \"==\", userId)\n    );\n    const snapshot = await getDocs(q);\n    console.log('Firestore query successful, docs count:', snapshot.docs.length);\n    \n    const bills = snapshot.docs.map(doc => {\n      const data = doc.data();\n      return {\n        id: doc.id,\n        userId: data.userId,\n        providerName: data.providerName,\n        billType: data.billType,\n        amount: data.amount,\n        dueDate: data.dueDate?.toDate() || new Date(),\n        createdAt: data.createdAt?.toDate() || new Date(),\n      };\n    });\n    return bills.sort((a, b) => a.dueDate.getTime() - b.dueDate.getTime());\n  } catch (error) {\n    console.error('Firestore fetchBills error:', error);\n    console.error('Auth currentUser at error time:', auth.currentUser?.uid);\n    throw error;\n  }\n}\n\nexport async function deleteBill(billId: string) {\n  await deleteDoc(doc(db, \"bills\", billId));\n}\n\nexport type { User };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/contexts/AuthContext.tsx"],"sourcesContent":["'use client';\n\nimport { createContext, useContext, useEffect, useState, ReactNode } from 'react';\nimport { User, subscribeToAuth, loginUser, registerUser, logoutUser } from '../lib/firebase';\n\ninterface AuthContextType {\n  user: User | null;\n  loading: boolean;\n  error: string | null;\n  login: (email: string, password: string) => Promise<void>;\n  signup: (email: string, password: string) => Promise<void>;\n  logout: () => Promise<void>;\n  clearError: () => void;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const unsubscribe = subscribeToAuth((user) => {\n      setUser(user);\n      setLoading(false);\n    });\n    return () => unsubscribe();\n  }, []);\n\n  const login = async (email: string, password: string) => {\n    setError(null);\n    setLoading(true);\n    try {\n      await loginUser(email, password);\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : 'Login failed';\n      setError(getAuthErrorMessage(message));\n      throw err;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const signup = async (email: string, password: string) => {\n    setError(null);\n    setLoading(true);\n    try {\n      await registerUser(email, password);\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : 'Signup failed';\n      setError(getAuthErrorMessage(message));\n      throw err;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const logout = async () => {\n    setError(null);\n    try {\n      await logoutUser();\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : 'Logout failed';\n      setError(message);\n      throw err;\n    }\n  };\n\n  const clearError = () => setError(null);\n\n  return (\n    <AuthContext.Provider value={{ user, loading, error, login, signup, logout, clearError }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n}\n\nfunction getAuthErrorMessage(errorMessage: string): string {\n  if (errorMessage.includes('auth/email-already-in-use')) {\n    return 'This email is already registered. Please sign in instead.';\n  }\n  if (errorMessage.includes('auth/invalid-email')) {\n    return 'Please enter a valid email address.';\n  }\n  if (errorMessage.includes('auth/weak-password')) {\n    return 'Password must be at least 6 characters.';\n  }\n  if (errorMessage.includes('auth/user-not-found') || errorMessage.includes('auth/wrong-password') || errorMessage.includes('auth/invalid-credential')) {\n    return 'Invalid email or password.';\n  }\n  if (errorMessage.includes('auth/too-many-requests')) {\n    return 'Too many attempts. Please try again later.';\n  }\n  return errorMessage;\n}\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;;;AAHA;;;AAeA,MAAM,4BAAc,IAAA,8KAAa,EAA8B;AAExD,SAAS,aAAa,EAAE,QAAQ,EAA2B;;IAChE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAc;IAC9C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAgB;IAElD,IAAA,0KAAS;kCAAC;YACR,MAAM,cAAc,IAAA,4IAAe;sDAAC,CAAC;oBACnC,QAAQ;oBACR,WAAW;gBACb;;YACA;0CAAO,IAAM;;QACf;iCAAG,EAAE;IAEL,MAAM,QAAQ,OAAO,OAAe;QAClC,SAAS;QACT,WAAW;QACX,IAAI;YACF,MAAM,IAAA,sIAAS,EAAC,OAAO;QACzB,EAAE,OAAO,KAAc;YACrB,MAAM,UAAU,eAAe,QAAQ,IAAI,OAAO,GAAG;YACrD,SAAS,oBAAoB;YAC7B,MAAM;QACR,SAAU;YACR,WAAW;QACb;IACF;IAEA,MAAM,SAAS,OAAO,OAAe;QACnC,SAAS;QACT,WAAW;QACX,IAAI;YACF,MAAM,IAAA,yIAAY,EAAC,OAAO;QAC5B,EAAE,OAAO,KAAc;YACrB,MAAM,UAAU,eAAe,QAAQ,IAAI,OAAO,GAAG;YACrD,SAAS,oBAAoB;YAC7B,MAAM;QACR,SAAU;YACR,WAAW;QACb;IACF;IAEA,MAAM,SAAS;QACb,SAAS;QACT,IAAI;YACF,MAAM,IAAA,uIAAU;QAClB,EAAE,OAAO,KAAc;YACrB,MAAM,UAAU,eAAe,QAAQ,IAAI,OAAO,GAAG;YACrD,SAAS;YACT,MAAM;QACR;IACF;IAEA,MAAM,aAAa,IAAM,SAAS;IAElC,qBACE,6LAAC,YAAY,QAAQ;QAAC,OAAO;YAAE;YAAM;YAAS;YAAO;YAAO;YAAQ;YAAQ;QAAW;kBACpF;;;;;;AAGP;GA3DgB;KAAA;AA6DT,SAAS;;IACd,MAAM,UAAU,IAAA,2KAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QACzB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;IANgB;AAQhB,SAAS,oBAAoB,YAAoB;IAC/C,IAAI,aAAa,QAAQ,CAAC,8BAA8B;QACtD,OAAO;IACT;IACA,IAAI,aAAa,QAAQ,CAAC,uBAAuB;QAC/C,OAAO;IACT;IACA,IAAI,aAAa,QAAQ,CAAC,uBAAuB;QAC/C,OAAO;IACT;IACA,IAAI,aAAa,QAAQ,CAAC,0BAA0B,aAAa,QAAQ,CAAC,0BAA0B,aAAa,QAAQ,CAAC,4BAA4B;QACpJ,OAAO;IACT;IACA,IAAI,aAAa,QAAQ,CAAC,2BAA2B;QACnD,OAAO;IACT;IACA,OAAO;AACT"}}]
}